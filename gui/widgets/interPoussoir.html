<!-- 
LISTE DES VARIABLES UTILISABLES
#nom# -> Nom donner au produit
#zone# -> Nom de la zone ou est situé le produit
#reference# -> Nom de la référnence Legrand (ex:Inter Variateur 300W à voyant)
#id_legrand# -> id du produit
#ref_legrand# -> référence legrand
#media# -> type de media pour le produit (CPL,RF,IR)
#family# -> famille du produit (LIGHTING,SHUTTER,etc.)
#unit_code# -> code du unit
 -->

<!-- Widget Inter Simple -->
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-4" id="#id_legrand#">
	<div class="widget-box" id="tools_#id_legrand#">
		<div class="widget-header">
			<h5>#nom#</h5>

			<div class="widget-toolbar">
				<a href="#" data-action="reload">
					<i class="icon-refresh"></i>
				</a>

				<a href="#" data-action="collapse">
					<i class="icon-chevron-up"></i>
				</a>

				<a href="#" data-action="close">
					<i class="icon-remove"></i>
				</a>
			</div>
		</div>
		<div class="widget-body">
			<div class="widget-main">
				<div class="row" id="#id_legrand#_MODULE_0" style="display:none">
					<div class="col-xs-4 text-right">
						<a class="btn btn-app btn-light btn-xs" href="#" data-action="#id_legrand#_OFF_0">
							<i class="icon-power-off bigger-200"></i>
							OFF
						</a>
					</div>
					<div class="col-xs-4 text-left">
						<a class="btn btn-app btn-light btn-xs" href="#" data-action="#id_legrand#_ON_0">
							<i class="icon-sun bigger-200"></i>
							ON
						</a>
					</div>
					<div class="col-xs-4 text-center">
						<div class="easy-pie-chart percentage" data-percent="0" data-color="#D15B47" data-action="#id_legrand#_STATUS_0">
							<span class="percent">...</span>
						</div>
					</div>
				</div>
				<div class="row" id="#id_legrand#_MODULE_1" style="display:none">
					<div class="col-xs-4 text-right">
						<a class="btn btn-app btn-light btn-xs" href="#" data-action="#id_legrand#_OFF_1">
							<i class="icon-power-off bigger-200"></i>
							OFF
						</a>
					</div>
					<div class="col-xs-4 text-left">
						<a class="btn btn-app btn-light btn-xs" href="#" data-action="#id_legrand#_ON_1">
							<i class="icon-sun bigger-200"></i>
							ON
						</a>
					</div>
					<div class="col-xs-4 text-center">
						<div class="easy-pie-chart percentage" data-percent="0" data-color="#D15B47" data-action="#id_legrand#_STATUS_1">
							<span class="percent">...</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
//VARIABLE DU WIDGET (SEUL VARIABLE GOLBALE)
var widget_#id_legrand# = {};
widget_#id_legrand#.module = [];
widget_#id_legrand#.media = '#media#';
widget_#id_legrand#.reference = '#reference#';

//DEFINITION DES ACTIONS EN FONCTION DES MODULES
if ('#ref_legrand#' == '67201'
	|| '#ref_legrand#' == '67203'
	|| '#ref_legrand#' == '3600'
	|| '#ref_legrand#' == '88202') {
	widget_#id_legrand#.module[0] = {};
	widget_#id_legrand#.module[0].unit_status = 2;
	widget_#id_legrand#.module[0].trame = [];
	widget_#id_legrand#.module[0].trame["#id_legrand#_ON_0"] = InOne.ownManager_createFrame('#id_legrand#|2', 'ON', 'AU', [], 'CPL');
	widget_#id_legrand#.module[0].trame["#id_legrand#_OFF_0"] = InOne.ownManager_createFrame('#id_legrand#|2', 'OFF', 'AU', [], 'CPL');
}
if ('#ref_legrand#' == '67202'
	|| '#ref_legrand#' == '67204') {
	widget_#id_legrand#.module[0] = {};
	widget_#id_legrand#.module[0].unit_status = 3;
	widget_#id_legrand#.module[0].trame = [];
	widget_#id_legrand#.module[0].trame["#id_legrand#_ON_0"] = InOne.ownManager_createFrame('#id_legrand#|3', 'ON', 'AU', [], 'CPL');
	widget_#id_legrand#.module[0].trame["#id_legrand#_OFF_0"] = InOne.ownManager_createFrame('#id_legrand#|3', 'OFF', 'AU', [], 'CPL');
	widget_#id_legrand#.module[1] = {};
	widget_#id_legrand#.module[1].unit_status = 4;
	widget_#id_legrand#.module[1].trame = [];
	widget_#id_legrand#.module[1].trame["#id_legrand#_ON_1"] = InOne.ownManager_createFrame('#id_legrand#|4', 'ON', 'AU', [], 'CPL');
	widget_#id_legrand#.module[1].trame["#id_legrand#_OFF_1"] = InOne.ownManager_createFrame('#id_legrand#|4', 'OFF', 'AU', [], 'CPL');
}
if ('#ref_legrand#' == '67238') {
	widget_#id_legrand#.module[0] = {};
	widget_#id_legrand#.module[0].unit_status = 1;
	widget_#id_legrand#.module[0].trame = [];
	widget_#id_legrand#.module[0].trame["#id_legrand#_ON_0"] = InOne.ownManager_createFrame('#id_legrand#|1', 'ON', 'B', [], 'RF');
	widget_#id_legrand#.module[0].trame["#id_legrand#_OFF_0"] = InOne.ownManager_createFrame('#id_legrand#|1', 'OFF', 'B', [], 'RF');
	widget_#id_legrand#.module[1] = {};
	widget_#id_legrand#.module[1].unit_status = 2;
	widget_#id_legrand#.module[1].trame = [];
	widget_#id_legrand#.module[1].trame["#id_legrand#_ON_1"] = InOne.ownManager_createFrame('#id_legrand#|2', 'ON', 'B', [], 'RF');
	widget_#id_legrand#.module[1].trame["#id_legrand#_OFF_1"] = InOne.ownManager_createFrame('#id_legrand#|2', 'OFF', 'B', [], 'RF');
}

//GESTION DES BOUTONS
$.each(widget_#id_legrand#.module, function(module_key) {
	$('##id_legrand#_MODULE_'+module_key).show();
	$('##id_legrand#_MODULE_'+module_key+' .btn').each(function() {
		var btn = $(this);
		var action = btn.attr('data-action');
		$('[data-action="'+action+'"]').click(function() {
			var trame = InOne.ownManager_starsharp_to_YZ(widget_#id_legrand#.module[module_key].trame[action]);
			var _dc = new Date().getTime();
			$.getJSON( "../back/client.php?output=JSON&type=trame&send_command="+trame+"&_dc="+_dc, function( data ) {
				;
			});
			if (action.match(/ON/)) {
				$('[data-action="#id_legrand#_STATUS_'+module_key+'"]').data('easyPieChart').update(100);
				$('[data-action="#id_legrand#_STATUS_'+module_key+'"] .percent').html('ON');
			} else if (action.match(/OFF/)) {
				$('[data-action="#id_legrand#_STATUS_'+module_key+'"]').data('easyPieChart').update(0);
				$('[data-action="#id_legrand#_STATUS_'+module_key+'"] .percent').html('OFF');
			}
		});
	});
});


//GESTION DE LA MISE A JOUR
var load_#id_legrand# = function(autoreload) {
	var param_#id_legrand# = encodeURI('[{"type":"string","value":"#id_legrand#","field":"id_legrand"}]');
	var _dc = new Date().getTime();
	$.getJSON( "../back/client.php?output=JSON&view=view_equipements_status&filter="+param_#id_legrand#+"&limit=16&_dc="+_dc, function( data ) {
		if ($.isArray(data.request.content.module)) {
			var modules = data.request.content.module;
		} else {
			var modules = [];
			modules[0] = data.request.content.module;
		}
		$.each(modules, function(module_key, module_val) {
			var module = module_val;
			$.each(widget_#id_legrand#.module, function(widgetStatus_key) {
				if (module.unit_status == widget_#id_legrand#.module[widgetStatus_key].unit_status) {
					var status_value = 0;
					var status_text = module.status;
					if (module.status == 'OFF'
						|| module.status == '0') {
						status_value = 0;
						status_text = 'OFF';
					} else if (module.status == 'ON'
							|| module.status == '100') {
						status_value = 100;
						status_text = 'ON';
					}
					$('[data-action="#id_legrand#_STATUS_'+widgetStatus_key+'"]').data('easyPieChart').update(status_value);
					$('[data-action="#id_legrand#_STATUS_'+widgetStatus_key+'"] .percent').html(status_text);
				}
			});
		});
	});
	if (autoreload === true) {
		timeout_#id_legrand# = setTimeout("load_#id_legrand#(true)",10000);
	}
};
load_#id_legrand#(true);

//GESTION DU STATUS
var oldie = /msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase());
$('##id_legrand# .easy-pie-chart.percentage').each(function(){
	$(this).easyPieChart({
		barColor: $(this).data('color'),
		trackColor: '#EEEEEE',
		scaleColor: false,
		lineCap: 'butt',
		lineWidth: 8,
		animate: oldie ? false : 1000,
		size:65
	}).css('color', $(this).data('color'));
});

//GESTION DU BOUTON RELOAD
$('#tools_#id_legrand#').trigger('reloaded.ace.widget');
$('#tools_#id_legrand#').on({
	'reload.ace.widget' : function(e) {
		//e.preventDefault();//to prevent reloading
		load_#id_legrand#();
		e.stopPropagation();//stop propagating to the event defined in ace.min.js which you should remove altogether
	}
});

//GESTION DE LA FERMETURE
close_widgets(function() {
	clearTimeout(timeout_#id_legrand#);
});
</script>
<!-- /Widget Inter Simple -->
